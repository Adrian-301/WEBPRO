<?php
// Menangani proses upload gambar
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['image'])) {
    $uploadDir = 'uploads/';
    $uploadFile = $uploadDir . basename($_FILES['image']['name']);
    
    // Validasi file gambar
    $imageFileType = strtolower(pathinfo($uploadFile, PATHINFO_EXTENSION));
    $allowedTypes = ['jpg', 'jpeg', 'png', 'gif'];
    
    if (in_array($imageFileType, $allowedTypes)) {
        if (move_uploaded_file($_FILES['image']['tmp_name'], $uploadFile)) {
            echo "File successfully uploaded.";
            header("Location: backend.php");
            exit;
        } else {
            echo "Failed to upload file.";
        }
    } else {
        echo "Invalid file type. Only JPG, PNG, and GIF are allowed.";
    }
}

// Menangani penghapusan gambar
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['delete_image'])) {
    $imagePath = $_POST['delete_image'];

    if (file_exists($imagePath)) {
        if (unlink($imagePath)) {
            echo 'Image deleted successfully.';
        } else {
            echo 'Failed to delete the image.';
        }
    } else {
        echo 'File not found.';
    }
}

// Mendapatkan semua gambar yang ada di folder 'uploads/'
$images = glob("uploads/*.{jpg,png,gif,jpeg}", GLOB_BRACE);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShadePin Gallery</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            color: #000;
        }
        .dark-mode {
            background-color: #2c3e50;
            color: #ecf0f1;
        }
        .card {
            transition: transform 0.2s;
        }
        .card:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center">Image Gallery</h1>

        <button class="btn btn-secondary" id="toggle-dark-mode">ðŸŒ™</button>

        <div class="text-center mb-4 mt-4">
            <a href="backend.php" class="btn btn-primary">Go to Gallery</a>
        </div>

        <!-- Form Upload Image -->
        <form action="backend.php" method="POST" enctype="multipart/form-data">
            <div class="text-center mb-4">
                <input type="file" name="image" accept="image/*" required>
                <button type="submit" class="btn btn-success">Upload Image</button>
            </div>
        </form>

        <!-- Gallery Grid -->
        <div class="row" id="image-grid">
            <?php foreach ($images as $image): ?>
                <div class="col-md-3 mb-4">
                    <div class="card">
                        <img src="<?= $image ?>" class="card-img-top" alt="Image">
                        <div class="card-body">
                            <a href="<?= $image ?>" download class="btn btn-primary">Save Image</a>
                            <form method="POST" style="display:inline;">
                                <button type="submit" name="delete_image" value="<?= $image ?>" class="btn btn-danger">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            <?php endforeach; ?>
        </div>
    </div>

    <script>
        // Toggle Dark Mode
        $('#toggle-dark-mode').click(function() {
            $('body').toggleClass('dark-mode');
            $(this).text($(this).text() === 'ðŸŒ™' ? 'ðŸŒž' : 'ðŸŒ™');
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
</body>
</html>
